<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>    
    <script src="https://code.jquery.com/jquery.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0/js/bootstrap.bundle.min.js"></script>
    <title>GifTastic GMenocal</title>
</head>
<body>

    <div id="buttons">
            <button data-search ="coffee">Coffee!</button>
            <button data-search ="dog">Dogs!</button>
            <button data-search ="travel">Travel</button>
            <button data-search ="technology">Technology!</button>
            <button data-search ="quantum">Quantum!</button>
            <button data-search ="movies">Movies!</button>
            <br> <br>
    </div>

    <div id="newTopic">
            <form>
                    <label for="topicInput">Add a New Topic</label>
                    <input type="text" id="topicInput"><br>              
                    <input id="addTopic" type="submit" value="Add Topic">
            </form>
            <div id="warning"></div>
    </div>

      

    <div id="giphy">      

    </div>

    <script type="text/javascript">

    $(document).ready(function(){

        var topics = ["coffee", "dog","travel","technology","quantum", "movies"];

        // Add a new Topic part

        $("#addTopic").on("click", function(event){
            
            event.preventDefault();
            var newTopic = $("#topicInput").val().trim();
            textNewTopic = newTopic;
            newTopic = newTopic.toLowerCase();
            console.log(newTopic);

            var found = topics.find(function(element){
                return element === newTopic;
            });               

            if(newTopic != found){
               var newButton = $("<button>");
                newButton.attr('data-search', newTopic);
                newButton.text(textNewTopic);
                $("#buttons").prepend(newButton);
                topics.push(newTopic);
                console.log(topics);
            }else{

                $("#warning").text("Topic already exist!!");
                setTimeout(function(){
                    $("#warning").empty();
                    $("#topicInput").empty();
                },3000);

                console.log("Topic already exist!!");

            };

        })

        // Get Gif after clicked


        $("button").on("click", function(){   

            $("#giphy").empty();

            var value = $(this).data("search");       
            
            console.log(value);

            var queryURL = "https://api.giphy.com/v1/gifs/search?q="+value+"&api_key=AayDwvCoJ57erpfcdEVKZo3dq1xJcJPB&limit=10";

            console.log(queryURL);

            $.ajax ({
                url:queryURL,
                method: 'GET'
            })
                .done(function(response){
                    for( var i=0; i<response.data.length;i++)
                    {
                        var topicDiv = $("<div>");
                        topicDiv.addClass(value);
                        var p = $("<p>").text("Rating = "+response.data[i].rating);
                        var topicImage = $("<img>");
                        topicImage.attr('src', response.data[i].images.fixed_height_small_still.url);
                        topicImage.attr('data-state', "still");
                        topicImage.attr('data-still', response.data[i].images.fixed_height_small_still.url);
                        topicImage.attr('data-animate', response.data[i].images.fixed_height_small.url);
                        topicImage.addClass('imgClicked');
                        topicDiv.prepend(p);
                        console.log(topicDiv);
                        topicDiv.prepend(topicImage);
                        console.log(topicImage);
                        console.log(topicDiv);
                        $("#giphy").prepend(topicDiv);  
                        // $("#giphy").prepend("<img src='"+response.data[i].images.fixed_height_small_still.url+"'>");  
                        // $("imgClicked").prepend(topicImage);                       
                    };

                    $("img.imgClicked").on("click", function() {
                        state = $(this).attr('data-state');
                        // console.log(state);
                        
                        if (state === "still")
                        {
                        $(this).attr("src", $(this).attr("data-animate"));
                        $(this).attr("data-state", "animate");
                        }
                        else 
                        {
                        $(this).attr("src", $(this).attr("data-still"));
                        $(this).attr("data-state", "still");
                        }                                    
                    });           
                });
                // .catch(function(error){
                //     console.log("Something went wrong!!");
                // });
  

            
        });
    }); 
   
    </script>
    
</body>
</html>